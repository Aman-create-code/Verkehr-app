<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Traffic Sweet - GitHub Edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    #map { height: calc(100vh - 280px); border-radius: 20px; margin: 10px; }
    body { background-color: #0a0a0a; color: white; }
    .glass { background: rgba(20, 20, 20, 0.9); backdrop-filter: blur(10px); }
  </style>
</head>
<body>

<header class="p-5 glass border-b border-white/10 flex justify-between items-center">
  <h1 class="text-2xl font-black italic text-blue-500">TRAFFIC SWEET</h1>
  <div class="bg-blue-600/20 px-4 py-2 rounded-full border border-blue-500/50">
    <span id="speed" class="text-xl font-bold">0</span> <span class="text-[10px]">km/h</span>
  </div>
</header>

<div id="map" class="shadow-2xl shadow-blue-500/10"></div>

<footer class="fixed bottom-0 w-full p-4 glass grid grid-cols-4 gap-2">
  <button onclick="report('police')" class="bg-slate-800 p-3 rounded-xl flex flex-col items-center"><i class="fas fa-shield-alt text-blue-400"></i><span class="text-[9px] mt-1">POLIZEI</span></button>
  <button onclick="report('speed')" class="bg-slate-800 p-3 rounded-xl flex flex-col items-center"><i class="fas fa-camera text-red-400"></i><span class="text-[9px] mt-1">BLITZER</span></button>
  <button onclick="report('accident')" class="bg-slate-800 p-3 rounded-xl flex flex-col items-center"><i class="fas fa-car-crash text-orange-400"></i><span class="text-[9px] mt-1">UNFALL</span></button>
  <button onclick="report('traffic')" class="bg-slate-800 p-3 rounded-xl flex flex-col items-center"><i class="fas fa-traffic-light text-amber-400"></i><span class="text-[9px] mt-1">STAU</span></button>
</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBYAb-92E5V94UhNVAQl9niTAPkBOBNOjc",
    authDomain: "verkehr-725d5.firebaseapp.com",
    projectId: "verkehr-725d5",
    storageBucket: "verkehr-725d5.firebasestorage.app",
    messagingSenderId: "22824354784",
    appId: "1:22824354784:web:90c034d1225dc6837ae185"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  let map, userPos, userMarker;

  if (navigator.geolocation) {
    navigator.geolocation.watchPosition(pos => {
      userPos = [pos.coords.latitude, pos.coords.longitude];
      const speedKmh = Math.round((pos.coords.speed || 0) * 3.6);
      document.getElementById('speed').innerText = speedKmh;
      
      if (!map) {
        map = L.map('map', { zoomControl: false }).setView(userPos, 15);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
        userMarker = L.circleMarker(userPos, { radius: 8, color: 'white', fillColor: '#3b82f6', fillOpacity: 1 }).addTo(map);
        loadMarkers();
      } else {
        userMarker.setLatLng(userPos);
      }
    }, null, { enableHighAccuracy: true });
  }

  window.report = async (type) => {
    await addDoc(collection(db, "reports"), { type, lat: userPos[0], lng: userPos[1], time: Date.now() });
  };

  function loadMarkers() {
    onSnapshot(collection(db, "reports"), snap => {
      snap.docChanges().forEach(change => {
        const d = change.doc.data();
        if (Date.now() - d.time < 3600000) {
           L.marker([d.lat, d.lng], { icon: L.divIcon({ html: `<div class="text-2xl">⚠️</div>`, className: 'bg-transparent'}) }).addTo(map);
        }
      });
    });
  }
</script>
</body>
</html>
